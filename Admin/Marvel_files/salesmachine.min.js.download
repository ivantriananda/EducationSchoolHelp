/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
* Lightweight JSONP fetcher
* Copyright 2010-2012 Erik Karlsson. All rights reserved.
* BSD licensed
*/

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.Salesmachine=t()})(this,function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/vendor/almond",function(){});var Base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(e){var t="",n,r;e=e.replace(/\r\n/g,"\n");for(r=0;r<e.length;r++)n=e.charCodeAt(r),n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(n&63|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(n&63|128));return t},n=function(e){var t="",n=0,r=0,i=0,s=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(i=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|i&63),n+=2):(i=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(i&63)<<6|s&63),n+=3);return t},r=function(e){var t="",n;for(n=0;n<e.length;n++)t+=e.charCodeAt(n).toString(16);return t},i=function(e){var t="",n;e.length%2>0&&(e="0"+e);for(n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.charAt(n)+e.charAt(n+1),16));return t},s=function(n){var r="",i,s,o,u,a,f,l,c=0;n=t(n);while(c<n.length)i=n.charCodeAt(c++),s=n.charCodeAt(c++),o=n.charCodeAt(c++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),r+=e.charAt(u),r+=e.charAt(a),r+=e.charAt(f),r+=e.charAt(l);return r},o=function(t){var r="",i,s,o,u,a,f,l,c=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<t.length)u=e.indexOf(t.charAt(c++)),a=e.indexOf(t.charAt(c++)),f=e.indexOf(t.charAt(c++)),l=e.indexOf(t.charAt(c++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,r+=String.fromCharCode(i),f!==64&&(r+=String.fromCharCode(s)),l!==64&&(r+=String.fromCharCode(o));return n(r)},u=function(e){return r(o(e))},a=function(e){return s(i(e))};return{encode:s,decode:o,decodeToHex:u,encodeFromHex:a}}();define("lib/vendor/base64",function(){}),typeof JSON!="object"&&(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;typeof JSON.stringify!="function"&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("lib/vendor/json2",function(){});var JSONP=function(){function i(e,n){var i=document.createElement("script"),s=!1;i.src=e,i.async=!0;var o=n||r.error;typeof o=="function"&&(i.onerror=function(t){o({url:e,event:t})}),i.onload=i.onreadystatechange=function(){!s&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(s=!0,i.onload=i.onreadystatechange=null,i&&i.parentNode&&i.parentNode.removeChild(i))},t||(t=document.getElementsByTagName("head")[0]),t.appendChild(i)}function s(e){return encodeURIComponent(e)}function o(t,o,u,a){var f=(t||"").indexOf("?")===-1?"?":"&",l;a=a||r.callbackName||"callback";var c=a+"_json"+ ++e;o=o||{};for(l in o)o.hasOwnProperty(l)&&(f+=s(l)+"="+s(o[l])+"&");return n[c]=function(e){u(e);try{delete n[c]}catch(t){}n[c]=null},i(t+f+a+"="+c),c}function u(e){r=e}var e=0,t,n=this,r={};return{get:o,init:u}}();return define("lib/vendor/jsonp",function(){}),require(["lib/vendor/base64","lib/vendor/json2","lib/vendor/jsonp"]),define("Salesmachine",[],function(){function e(){this.api_token="",this.api_version="v1",this.host="api.salesmachine.io",this.protocol="https",this._debug=!1,this.debug("Salesmachine instance")}return e.prototype.debug=function(e){this._debug&&console.log(e)},e.prototype.init=function(e,t){return this.api_token=e,this.options=t!=null?t:{},this.options.protocol&&(this.protocol=this.options.protocol),this.options.host&&(this.host=this.options.host),this.options.debug&&(this._debug=this.options.debug),this.debug("init"),e},e.prototype._build_message=function(e,t){var n={};return t.created_at||(t.created_at=(new Date).getTime()),n._method=e,n.api_token=this.api_token,n.encode="base64",n.data=Base64.encode(JSON.stringify(t)),n},e.prototype._build_url=function(e){var t=this.protocol+"://"+this.host+"/"+this.api_version;switch(e){case"event":t+="/track/event";break;case"account":t+="/account";break;case"contact":t+="/contact"}return this.debug(t),t},e.prototype.callback=function(e){e!=="success"},e.prototype.post=function(e,t){var n=this._build_message("post",t),r="";return typeof this.api_token!="undefined"&&this.api_token.trim().length>0?JSONP.get(this._build_url(e),n,this.callback):console.log("Missing api_token"),"sent"},e.prototype.get=function(e,t){var n=this._build_message("get",t);return typeof this.api_token!="undefined"&&this.api_token.trim().length>0?JSONP.get(this._build_url(e),n,this.callback):console.log("Missing api_token"),"sent"},e.prototype.pageview=function(e,t){return arguments.length!=2?console.log("Missing argument in Salesmachine.pageview"):(t=t||{},t.visit_url=window.location.href,t.visit_ip=window.location.hostname,t.visit_agent=navigator.userAgent,this.track(e,"pageview",t))},e.prototype.page_view=e.prototype.pageview,e.prototype.account=function(e,t){if(arguments.length!=2)return console.log("Missing argument in Salesmachine.account");var n={};return n.account_uid=e,n.created_at=(new Date).getTime(),n.params=t,this.post("account",n)},e.prototype.contact=function(e,t){if(arguments.length!=2)return console.log("Missing argument in Salesmachine.user");var n={};return n.contact_uid=e,n.created_at=(new Date).getTime(),n.params=t,this.post("contact",n)},e.prototype.user=e.prototype.contact,e.prototype.track=function(e,t,n){if(arguments.length!=3)return console.log("Missing argument in Salesmachine.track");var r={};return r.contact_uid=e,r.event_uid=t,r.created_at=(new Date).getTime(),r.params=n,this.post("event",r)},e.prototype.track_event=e.prototype.track,e}),define("salesmachine",["Salesmachine"],function(e){var t,n,r,i;if(!window.salesmachine||!window.salesmachine.loaded){i=new e,i.debug("salesmachine loaded"),r=window.salesmachine,window.salesmachine=i,window.Salesmachine=e;while(r&&r.length>0)t=r.shift(),n=t.shift(),i[n]&&(i.debug("apply method"+i+n),i.debug(i),i.debug(t),i[n].apply(i,t))}return window.salesmachine}),define("lib/salesmachine",function(){}),require(["lib/salesmachine"]),require("salesmachine")});